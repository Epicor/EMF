/*
 * emf (Epicor Mobile Framework) 
 * version:1.0.12-dev.27 built: 08-03-2017
*/
if("undefined"==typeof __ep_build_info)var __ep_build_info={};__ep_build_info.data={libName:"data",version:"1.0.12-dev.27",built:"2017-03-08"},function(){"use strict";angular.module("ep.token",["ep.sysconfig","ep.utils"])}(),function(){"use strict";angular.module("ep.data.model",["ep.utils"])}(),function(){"use strict";angular.module("ep.odata",[])}(),function(){"use strict";angular.module("ep.search",["ep.token","ep.templates"])}(),function(){"use strict";angular.module("ep.table",["ep.templates"])}(),angular.module("ep.binding",["ep.templates","ep.sysconfig"]),angular.module("ep.erp",["ep.templates","ep.modaldialog","ep.utils","ep.odata","ep.binding"]),function(){angular.module("ep.token").service("epErpRestService",["$http","$resource","epTokenService",function(a,b,c){function d(a,d,e){var f=c.getToken();if(f){var g=i+(d?d:"");if(d){var h=d.toLowerCase();0===h.indexOf("http")?g=d:0===h.indexOf("/api/swagger")&&(g=f.user.serverUrl+d)}return b(g,e,{get:{method:"GET",headers:{Authorization:"Bearer "+f.token.AccessToken,"Content-Type":"application/json"}}})}}function e(b,d,e){var f=c.getToken();if(f){var g=e;return e&&!angular.isString(e)&&(g=JSON.stringify(e)),a({method:"POST",dataType:"json",data:g,headers:{Authorization:"Bearer "+f.token.AccessToken,"Content-Type":"application/json",Accept:"application/json"},url:i+d})}}function f(b){var d=c.getToken();if(d)return a({method:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+d.token.AccessToken,"Content-Type":"application/json",Accept:"application/json"},url:i+b})}function g(b,d){var e=c.getToken();if(e&&i){var f=d;return d&&!angular.isString(d)&&(f=JSON.stringify(f)),a({method:"PATCH",dataType:"json",data:f,headers:{Authorization:"Bearer "+e.token.AccessToken,"Content-Type":"application/json",Accept:"application/json"},url:i+b}).success(function(a){console.log("updated "+b+" "+a)}).error(function(a){return console.log(a),!1})}}function h(b){var d=c.getToken();if(d)return a({method:"GET",headers:{Authorization:"Bearer "+d.token.AccessToken,"Content-Type":"application/xml; charset=utf-8",Accept:"application/xml"},url:i+b})}var i="";return{setUrl:function(a){i=a},get:function(a,b){return d("GET",a,b).get()},post:function(a,b){return e("POST",a,b)},remove:function(a){return f(a)},patch:g,getXML:h}}])}(),function(){"use strict";function a(a,b,c,d,e){b.settings={username:"",password:"",serverName:"",serverUrl:"",tokenUrl:"",token:{}},c.copyProperties(b.options,b.settings),b.loginUser=function(){if(b.options.fnOnLogin){var c=b.options.fnOnLogin(b.settings);return void(c&&c.hasError&&(b.hasError=!0,b.status=c.status))}if(d.showProgress({title:"Logging in",message:""}),""===b.settings.username||""===b.settings.password)return b.hasError=!0,b.status=""===b.settings.username?"Oops.. There's no user name there!":"Oops.. You forgot to type your password!",void d.hide();if(""===b.settings.serverName)return b.hasError=!0,b.status="Oops... Don't forget to type the Server.",void d.hide();var f=e.resolveServerUrl(b.settings.serverName);b.settings.serverUrl=f.serverUrl,b.settings.tokenUrl=f.tokenUrl;var g={username:b.settings.username,password:b.settings.password,serverUrl:b.settings.serverUrl,serverName:f.serverName},h={restUri:b.settings.tokenUrl};"demo"===b.settings.username.toLowerCase()&&"demo"===b.settings.password.toLowerCase()&&b.settings.serverName&&"demo"===b.settings.serverName.toLowerCase()&&(h.debug=!0,h.timeout="10000"),e.login(g,h).success(function(c){b.accessToken=c.AccessToken;try{if(b.settings.token=e.getToken(),!b.settings.token)return;b.options.username=b.settings.username,b.options.serverName=b.settings.serverName,b.options.fnOnGetToken?a.when(b.options.fnOnGetToken(b.settings)).then(function(a){return a&&angular.isString(a)?(b.hasError=!0,void(b.status=a)):void(b.options.fnOnSuccess&&b.options.fnOnSuccess(b.settings))},function(a){b.hasError=!0,b.status=a}):b.options.fnOnSuccess&&b.options.fnOnSuccess(b.settings)}catch(d){alert(d.message)}}).error(function(a,c,d,e){void 0!==e&&null!==e?e.url:"";b.hasError=!0,b.status=401===c?"Please review the user or password.":"We couldn't connect to the server. Please review it."}),d.hide()},b.passwordKeyPress=function(a){b.hasError=!1,b.status="";var c="undefined"==typeof a.which?a.keyCode:a.which;13===c&&b.loginUser()},b.clearWarning=function(){b.hasError=!1,b.status=""},b.showServer=function(){b.showServerName=!b.showServerName}}a.$inject=["$q","$scope","epUtilsService","epModalDialogService","epTokenService"],angular.module("ep.token").controller("epLoginViewCtrl",a)}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"src/components/ep.token/ep-login-view/ep-login-view.html",controller:"epLoginViewCtrl",scope:{options:"="}}}angular.module("ep.token").directive("epLoginView",a)}(),function(){"use strict";function a(a,b){var c=b.getToken();a.user=c?c.user:{},a.status="",a.$watch(function(a){return a.hasToken=b.hasToken(),b.hasToken()}),a.login=function(){return a.hasError=!1,a.status="",a.user&&a.user.hasOwnProperty("username")&&a.user.hasOwnProperty("password")&&a.user.username&&a.user.password?void b.login(a.user).success(function(){a.hasToken=!0,a.onLoginSuccess&&a.onLoginSuccess(a.user)}).error(function(b,c,d,e){var f=void 0!==e&&null!==e?e.url:"";a.status="Login Failure at: "+f,a.hasError=!0,a.onLoginFail&&a.onLoginFail(a.status)}):(a.hasError=!0,void(a.status="Please fill required fields."))},a.logout=function(){b.logout(),a.user={},a.hasToken=!1},a.cancel=function(){a.onLoginCancel&&a.onLoginCancel()}}a.$inject=["$scope","epTokenService"],angular.module("ep.token").controller("epLoginCtrl",a)}(),function(){"use strict";function a(){return{restrict:"E",controller:"epLoginCtrl",templateUrl:"src/components/ep.token/ep-login/login.html",scope:{showTitle:"=",showLabels:"=",showCancel:"=",onLoginFail:"&",onLoginSuccess:"&",onLoginCancel:"&"}}}angular.module("ep.token").directive("epLogin",a)}(),function(){"use strict";angular.module("ep.token").provider("epTokenConfig",function(){var a={restUri:"https://localhost/ICE3/TokenResource.svc/",tokenId:"emf.token.auth",timeout:0,warnExpire:!0,warnExpireDuration:60,storePassword:!0,autoRenew:!1,debug:!1};this.$get=["epSysConfig",function(b){return b.mergeSection("ep.token",a),a}]})}(),function(){"use strict";function a(a,b,c,d,e,f,g){function h(a,b){return w.options={},e.copyProperties(d,w.options),e.copyProperties(b,w.options),t(a,w.options.restUri)}function i(){g.update(d.tokenId,void 0),w.tokenTimeoutPromise&&c.cancel(w.tokenTimeoutPromise)}function j(a,b,c){var d={title:"Login",closeButton:!0,templateOptions:{template:'<ep-login show-title="false" on-login-cancel="config.onLoginCancel()"></ep-login>'},onLoginCancel:function(){f.hide()}};e.copyProperties(c,d),f.showCustomDialog(d)}function k(){var a=g.get(d.tokenId);if(a&&a.expiresInSecs){var b=l(a);b||(i(),a=null)}return a}function l(a){var b=a||k(),c=0;if(b){var d=new Date;c=b.expiresUTC-d.getTime(),c=c<=0?0:Math.floor(c/1e3)}return c}function m(){var a=k();return void 0!==a&&!angular.equals({},a)}function n(){var a=k();w.options.fnRenewToken?w.options.fnRenewToken(a):a&&a.user&&t(a.user,a.uri)}function o(a,b){var c=e.ensureEndsWith(a,"/");c=c.substring(0,c.length-1);var d=c.toLowerCase().trim(),f="https://";0===d.indexOf("https://")?(f="https://",c=c.substring(f.length)):0===d.indexOf("http://")&&(f="http://",c=c.substring(f.length));var g="";return""!==b&&(g=b?"/"+b:"/TokenResource.svc"),{prefix:f,serverName:c,serverUrl:f+c,tokenUrl:f+c+g}}function p(b,c){var d={headers:{username:b.username,password:b.password,Accept:"application/json","Content-Type":"application/x-www-form-urlencoded"}},f=e.ensureEndsWith(c,"/");return a.post(f,null,d)}function q(a,c){var d=b.defer(),e=d.promise;e.success=function(a){return e.then(a),e},e.error=function(a){return e.then(null,a),e};var f={TokenType:"Bearer",AccessToken:"mySampleTokenDataValue"};return r(f,a,c),d.resolve(f),e}function r(a,b,c){var e=a&&a.AccessToken&&"Bearer"===a.TokenType?a:void 0,f=e&&a.ExpiresIn?a.ExpiresIn:w.options.timeout;w.options.timeout&&w.options.timeout<f&&(f=w.options.timeout);var h=new Date,i=new Date(h);i.setTime(i.getTime()+1e3*f),g.update(d.tokenId,{uri:c,user:b,token:e,createdUTC:h.getTime(),expiresUTC:i.getTime(),expiresInSecs:f}),v(f)}function s(){w.tokenTimeoutPromise&&c.cancel(w.tokenTimeoutPromise);var a=l();a?v(a):i()}function t(a,b){i();var c=b||w.options.restUri;if(w.options.debug)return q(a,c);var d=w.options.fnUserFetchToken||p;return d(a,c).success(function(b){r(b,a,c)}).error(function(){})}function u(a){w.options.fnRenewToken?w.options.fnRenewToken(a):a&&a.user&&t(a.user,a.uri)}function v(a){if(w.tokenTimeoutPromise&&c.cancel(w.tokenTimeoutPromise),w.options.warnExpire||w.options.autoRenew){var b=a>w.options.warnExpireDuration?a-w.options.warnExpireDuration:a;b-=5,w.tokenTimeoutPromise=c(function(){var a=k();if(a){var b=l();if(w.options.warnExpire){var c={title:"Expiration Notice",message:"Your session is about to expire in {timer} seconds...",autoClose:b,icon:"fa fa-warning fa-4x",buttons:[{text:"Continue",action:function(){u(a)}},{text:"Log Out",action:function(){i()}}],fnDefaultAction:function(){i()}};e.copyProperties(w.options.warnExpireDialogOptions,c),f.showMessage(c)}else w.options.autoRenew&&u(a)}},1e3*b)}}var w={tokenTimeoutPromise:void 0,options:{}};return s(),{login:h,logout:i,getToken:k,hasToken:m,getExpiresIn:l,renewToken:n,showLoginDialog:j,resolveServerUrl:o}}a.$inject=["$http","$q","$timeout","epTokenConfig","epUtilsService","epModalDialogService","epLocalStorageService"],angular.module("ep.token").service("epTokenService",a)}(),function(){"use strict";angular.module("ep.data.model").service("epDataModelService",["epUtilsService",function(a){function b(b){g[b]=a.merge({},h[b])}function c(a){delete g[a]}function d(b){a.merge(h[b],g[b]),delete g[b]}function e(a){return h[a]=h[a]||{},h[a]}function f(a){return Object.keys(h[a]).forEach(function(b){delete h[a][b]}),h[a]}var g={},h={};return{beginTransaction:b,commitTransaction:c,rollbackTransaction:d,getModel:e,clearModel:f}}])}(),function(){"use strict";angular.module("ep.odata").factory("odataQueryFactory",function(){function a(a,b){var c="";if("string"==typeof a&&(c=a,a=null),a&&a.constructor.toString().indexOf("Array")>1){var d;for(d=0;d<a.length;d++)c+=(""===c?"":",")+a[d];a=null}if(a)for(var e in a)a.hasOwnProperty(e)&&(c+=(""===c?"":",")+e,b&&a[e]&&(c+=" desc"));return c}function b(a){return"string"==typeof a&&(l.type=a),this}function c(a){return isNaN(a)||parseInt(Number(a))!==a||(l.$top=a),this}function d(a){return isNaN(a)||parseInt(Number(a))!==a||(l.$skip=a),this}function e(b){var c=a(b,!0);return""!==c&&(l.$orderby=c),this}function f(b){var c=a(b);return""!==c&&(l.$select=c),this}function g(b){var c=a(b);return""!==c&&(l.$expand=c),this}function h(a){if(a)for(var b in a)a.hasOwnProperty(b)&&a[b]&&(l.$filter=(l&&l.$filter?l.$filter+" and ":"")+b+" eq '"+a[b]+"'");return this}function i(a,b,c,d){var e={">":"gt",">=":"ge","<":"lt","<=":"le","=":"eq","==":"eq","!=":"ne","<>":"ne"};b=e[b]||b;var f="",g=d&&"or"in d&&d.or?" or ":" and ",h=angular.isString(c)||isNaN(c)?"'":"";if(null!==a&&void 0!==a&&null!==c&&void 0!==c){switch(b){case"math":if(!(d&&"mathOperand"in d&&"mathFunction"in d&&"mathCompareOp"in d))throw"Malformed math operation; params object must contain mathOperand, mathFunction, and mathCompareOp properties";if(isNaN(c)||isNaN(d.mathOperand))throw"The second argument and mathOperand for math functions needs to be a number";b=e[d.mathCompareOp]||d.mathCompareOp,a=a+" "+d.mathFunction+" "+d.mathOperand;break;case"endswith":case"startswith":a=b+"("+a+",'"+c+"')",b="eq",c="true",h="",f=d&&"not"in d&&d.not?"not ":"";break;case"contains":a="indexof("+a+",'"+c+"')",b=d&&"not"in d&&d.not?"lt ":"gt",c="0",h="";break;case"day":case"month":case"year":case"second":case"minute":case"hour":if(isNaN(c)&&parseInt(Number(c))!==c)throw"The second argument for date/time functions needs to be an integer";a=b+"("+a+")",b="eq"}l.$filter=(l&&l.$filter?l.$filter+g:"")+f+a+" "+b+" "+h+c+h}return this}function j(a,b){var c=b?" or ":" and ";return l.$filter=(l&&l.$filter?l.$filter+c:"")+a,this}function k(){var a=$.extend({},l);return l={},a}var l={};return{setType:b,setTop:c,setSkip:d,setOrderBy:e,setSelect:f,setExpands:g,setFilter:h,setWhere:i,setWhereCustom:j,compose:k}})}(),function(){"use strict";angular.module("ep.search").provider("searchConfig",function(){var a={searchUri:"https://localhost/EES/EpicorERP/search.xml"};this.$get=["epSysConfig",function(b){return b.mergeSection("ep.search",a),a}]})}(),function(){"use strict";function a(a,b){a.enterpriseSearch={},a.enterpriseSearch.searching=!1,a.enterpriseSearch.searchResults=null,a.enterpriseSearch.status="",a.enterpriseSearch.changeSearch=function(){var b=a.enterpriseSearch.searchText;""===b&&(a.enterpriseSearch.searchResults=null,a.enterpriseSearch.status="")},a.enterpriseSearch.runSearch=function(c){""!==c&&(a.enterpriseSearch.searching=!0,a.enterpriseSearch.searchResults=[],a.enterpriseSearch.status="",a.enterpriseSearch.hasError=!1,b.search(c,0,100).then(function(b){a.enterpriseSearch.searching=!1,a.enterpriseSearch.searchResults=b},function(b){a.enterpriseSearch.status="An error occurred: "+b.status,a.enterpriseSearch.searching=!1,a.enterpriseSearch.hasError=!0}))}}angular.module("ep.search").controller("epSearchCtrl",["$scope","searchService",a])}(),function(){"use strict";angular.module("ep.search").directive("epSearch",function(){return{restrict:"E",replace:!0,controller:"epSearchCtrl",templateUrl:"src/components/ep.search/search.html"}})}(),function(){"use strict";angular.module("ep.search").factory("searchService",["$http","searchConfig",function(a,b){function c(a,b,c){return d(a,b,c).then(function(a){return e(a)},function(){})}function d(c,d,e){var f=b.searchUri+"?locale="+(navigator.language?navigator.language:navigator.userLanguage)+"&preservenulls="+!1+"&likeLinkFormat=EWAUrl&callback=JSON_CALLBACK",g=(new Date).valueOf(),h="&q="+c+"&start="+d+"&cache="+g.toString()+"&pageSize="+e;return a.get(f+h)}function e(a){var b={};if(a&&a.hasOwnProperty("data")){var c=a.data,d=$.parseXML(c),e=$(d);e.find("[primaryTable]").each(function(){var a=[];$(this).find("[companyName]").each(function(){var b={location:this.getAttribute("location")||"",label:this.getAttribute("label")||"",companyContext:this.getAttribute("companyName"),keyTag:this.getAttribute("keyTag"),fields:[]};$("*",this).each(function(a,c){for(var d={},e=0,f=c.attributes.length;e<f;e++)d[c.attributes[e].nodeName]=c.attributes[e].nodeValue;d.FieldName=c.nodeName,d.FieldValue=c.textContent,b.fields.push(d)}),a.push(b)}),b[this.nodeName]={label:this.getAttribute("label"),primaryTable:this.getAttribute("primaryTable"),results:a}})}return b}return{search:c}}])}(),function(){"use strict";angular.module("ep.table").controller("epTableCtrl",["$scope",function(a){a.isLoading=!0,a.headers=a.columnHeaders?a.columnHeaders.split(",").map(function(a){return a.trim()}):[],a.colCount=a.headers.length,a.props=a.columnHeaders?a.columnProperties.split(",").map(function(a){return a.trim()}):[],a.isLoading=!1,a.selectRow=function(b,c){a.trackSelectedRow&&(a.data.selectedRow=b,a.data.forEach(function(a){a.$isSelected=!1}),b.$isSelected=!0,a.onSelectRow&&a.onSelectRow({row:b,$event:c}))},a.trackSelectedRow&&a.data&&a.data.length&&a.selectRow(a.data[0]),a.$watch("data",function(){a.trackSelectedRow&&a.data&&a.data.length&&!a.data.selectedRow&&a.selectRow(a.data[0])}),a.onDblClick=function(b,c){a.data&&a.data.length&&a.onDoubleClickRow&&a.onDoubleClickRow({row:b,$event:c})}}])}(),function(){"use strict";angular.module("ep.table").directive("epTable",function(){return{restrict:"E",replace:!0,scope:{data:"=",columnHeaders:"@",columnProperties:"@",trackSelectedRow:"=",striped:"=",onSelectRow:"&",onDoubleClickRow:"&"},controller:"epTableCtrl",templateUrl:"src/components/ep.table/table.html"}})}(),function(){"use strict";function a(a,b,c,d){return{restrict:"E",templateUrl:"src/components/ep.binding/controls/ep-binding-editor.html",scope:{epBinding:"=",column:"=",isRow:"="},link:function(a){var e;a.epBindingInfo={value:void 0,kind:"ep-editor-control"};var f={editor:"auto",updatable:!0};a.state={column:void 0,metaColumn:{},epBinding:{}},a.setBinding=function(f){e?e.changeBinding(f):e=new b(a,f,a.epBindingInfo),a.state.metaColumn={},a.state.epBinding.column===a.epBindingInfo.epBinding.column&&a.state.epBinding.view===a.epBindingInfo.epBinding.view||(a.state.metaColumn.caption=a.epBindingInfo.epBinding.column);var g=d.get(a.epBindingInfo.epBinding.view);if(g&&g.columns&&g.columns[a.epBindingInfo.epBinding.column]){var h=g.columns[a.epBindingInfo.epBinding.column];c.copyProperties(h,a.state.metaColumn)}a.state.epBinding.view=a.epBindingInfo.epBinding.view,a.state.epBinding.column=a.epBindingInfo.epBinding.column},a.setColumn=function(){var b=angular.extend({},f);a.state.metaColumn&&Object.keys(a.state.metaColumn).length&&c.copyProperties(a.state.metaColumn,b),a.column&&c.copyProperties(a.column,b),angular.equals(a.state.column,b)||(a.state.column=b)},a.$watch("epBinding",function(b,c){void 0!==b&&b!==c&&a.setBinding(b)}),a.$watch("column",function(b,c){void 0===b||angular.equals(b,c)||a.setColumn()}),a.epBinding&&a.setBinding(a.epBinding),a.setColumn()}}}a.$inject=["$location","epBindingFactory","epUtilsService","epBindingMetadataService"],angular.module("ep.binding").directive("epBindingEditor",a)}(),function(){"use strict";function a(a,b){return{restrict:"E",templateUrl:"src/components/ep.binding/controls/ep-binding-label.html",scope:{epBinding:"=",label:"@",labelClass:"@",required:"=",forCtrl:"@"},link:function(c){c.state={epBinding:{},label:c.label||"",requiredFlag:!1,metaColumn:{}},c.setBinding=function(d){var e=c.state.epBinding=a.parseBinding(d),f=b.get(e.view);f&&f.columns&&f.columns[e.column]&&(c.state.metaColumn=f.columns[e.column]||{})},c.setLabel=function(){c.state.label=c.state.metaColumn.caption||c.label||c.state.epBinding.column||""},c.$watch("epBinding",function(a,b){void 0!==a&&a!==b&&c.setBinding(a)}),c.epBinding&&c.setBinding(c.epBinding),c.setLabel()}}}a.$inject=["epBindingService","epBindingMetadataService"],angular.module("ep.binding").directive("epBindingLabel",a)}(),function(){"use strict";function a(a,b,c){return{restrict:"E",templateUrl:"src/components/ep.binding/controls/ep-binding-pagination.html",scope:{epBinding:"="},link:function(d){function e(a){a&&a.hasData()?(d.view=a,d.record=a.dataRow(),d.totalItems=a.data().length,d.currentPage=a.row()+1,d.maxSize=10):(d.view=null,d.totalItems=0,d.currentPage=0)}d.state={},d.view=null,d.totalItems=0,d.currentPage=0,a.$on("EP_BINDING_VIEW_ADDED",function(a,b){d.state.epBinding&&b.viewId===d.state.epBinding.view&&e(c.current().view(d.state.epBinding.view))}),a.$on("EP_BINDING_VIEW_ROW_CHANGED",function(a,b){d.state.epBinding&&b.viewId===d.state.epBinding.view&&(d.currentPage=b.view.row()+1)}),a.$on("EP_BINDING_VIEW_ROW_ADDED",function(a,b){if(d.state.epBinding&&b.viewId===d.state.epBinding.view){var c=d.view;d.record=c.dataRow(),d.totalItems=c.data().length,d.currentPage=c.row()+1}}),d.$watch("epBinding",function(a){if(void 0!==a){d.state.epBinding=b.parseBinding(a);var f=c.current().view(d.state.epBinding.view);f&&e(f)}}),d.onPageChange=function(){d.view&&d.view.row(d.currentPage-1)}}}}a.$inject=["$rootScope","epBindingService","epTransactionFactory"],angular.module("ep.binding").directive("epBindingPagination",a)}(),function(){"use strict";function epBindingRecordEditorDirective($log,$location,epBindingFactory,epCustomizationService,epUtilsService,epBindingMetadataService){return{restrict:"E",templateUrl:"src/components/ep.binding/controls/ep-binding-record-editor.html",scope:{epBinding:"=",options:"=",isreadonly:"=",onInit:"="},link:function(scope,element,attrs){function setOptions(){if(void 0!==scope.options){if(scope.options.columnList&&!scope.options.columns){var columns=[],colNames=scope.options.columnList.split(","),meta=epBindingMetadataService.get(scope.epBinding);angular.forEach(colNames,function(a){var b={columnIndex:a,editor:"auto",updatable:!0};if(meta&&meta.columns&&meta.columns[a]){var c=meta.columns[a];epUtilsService.copyProperties(c,b),b.editor=c.editor||b.editor}columns.push(b)}),scope.options.columns=columns}if(scope.options.columns&&scope.options.columns.length){var customProps=epCustomizationService.getCustomization(scope.state.id);customProps&&(angular.forEach(customProps,function(v,n){var col=_.find(scope.options.columns,function(a){return a.columnIndex===n});if(col){var valid=v.validation;if(epUtilsService.copyProperties(v,col),valid)try{var fff;eval("fff = function(ctx, ev, value) { "+valid+"}"),col.fnOnFldValidate=fff}catch(err){}}else scope.options.columns.push(v)}),scope.state.factory&&scope.state.factory.draw())}}}return attrs.id?(scope.state={id:attrs.id},scope.epCustomizationInfo={kind:"ep-record-editor",id:scope.state.id,scope:scope,url:$location.url(),data:void 0,index:void 0,ctrl:{epBinding:scope.epBinding,factory:void 0},api:{onCustomizeActivate:function(a){scope.isCustomizeActive=a===!0,scope.activeClass=scope.isCustomizeActive?"ep-customize-active":"",scope.epCustomizationInfo.ctrl.factory.enableEditorsDrag(a,a)}}},scope.onInitThis=function(a){scope.state.factory=a,scope.epCustomizationInfo.ctrl.factory=a,scope.onInit&&scope.onInit(a)},void scope.$watch("options",function(a){setOptions()},!0)):void $log.warn("ep-binding-record-editor must have an id for customization")}}}epBindingRecordEditorDirective.$inject=["$log","$location","epBindingFactory","epCustomizationService","epUtilsService","epBindingMetadataService"],angular.module("ep.binding").directive("epBindingRecordEditor",epBindingRecordEditorDirective)}(),function(){"use strict";function a(a,b,c,d){function e(a){var e=[];f.meta.column="",f.meta.preview="",f.config.binding="["+a+"]",f.isAllDataPreview=!1,f.loadingColumns=!0,b(function(){var b=c.current().view(a),g=d.get(a);if(g&&g.columns&&angular.forEach(g.columns,function(a,b){e.push({label:b,value:b})}),b.hasData()){var h=b.dataRow();f.meta.preview=JSON.stringify(h,null,"    "),0===e.length&&angular.forEach(h,function(a,b){e.push({label:b,value:b})})}f.columns=e,f.columnList.list=f.columns,f.loadingColumns=!1})}var f=a;f.config||(f.config={binding:""}),f.isAllDataPreview=!1,f.views=[],f.columns=[],a.meta={view:"",column:"",preview:"",info:""};var g=c.current().views();angular.forEach(g,function(a){f.views.push({label:a,value:a})}),f.views.length&&(a.meta.view=f.views[0].value),f.viewList={caption:"View",name:"View",editor:"select",updatable:!0,list:f.views,sizeClass:"col-lg-12",fnOnChange:function(a,b){f.columns=[];var c=b.fnGetCurrentValue();e(c)}},f.columnList={caption:"Columns",name:"Columns",editor:"select",updatable:!0,list:void 0,sizeClass:"col-lg-12",fnOnChange:function(a,b){f.config.binding="["+f.meta.view+"].["+f.meta.column+"]"}},f.columnBinding={caption:"ep-binding",sizeClass:"col-lg-12",editor:"text",updatable:!0,readonly:!0,placeholder:""},f.showAllData=function(a){f.isAllDataPreview=a;var b=c.current().view(f.meta.view);b.hasData()&&(f.isAllDataPreview?f.meta.preview=JSON.stringify(b.data(),null,"    "):f.meta.preview=JSON.stringify(b.dataRow(),null,"    "))},g.length&&e(g[0])}a.$inject=["$scope","$timeout","epTransactionFactory","epBindingMetadataService"],angular.module("ep.binding").controller("epBindingSelectorCtrl",a)}(),function(){"use strict";function a(a,b,c,d){return{restrict:"E",templateUrl:"src/components/ep.binding/controls/ep-binding-table.html",scope:{epBinding:"=",columns:"=",trackSelectedRow:"=",onSelectRow:"&",onDoubleClickRow:"&"},link:function(e,f,g){function h(){var a=d.getCustomization(e.state.id);angular.forEach(a,function(a,b){if(a.isCustom)e.state.columns.push(a);else if(a.hidden||a.caption){var c=_.find(e.state.columns,function(a){return a.name===b});c&&(a.hidden&&(c.hidden=a.hidden),a.caption&&(c.caption=a.caption))}})}function i(a){var b=[];return angular.forEach(e.state.columns,function(c){c.hidden!==!0&&b.push(a?c.caption:c.name)}),b.join(",")}function j(){e.headers=i(!0),e.dataColumns=i(!1)}e.epBindingInfo={value:void 0},e.state={id:g.id,data:void 0,columns:[]};var k=e.columns.split(",");angular.forEach(k,function(a){e.state.columns.push({name:a,caption:a})}),e.dblClickRow=function(a){e.onDoubleClickRow&&e.onDoubleClickRow({row:a})},e.$watch("epBinding",function(a){if(void 0!==a){var b={onViewReady:function(a){e.state.data=e.epBindingInfo.view.data(),e.ready=!0}};e.state.bindingFactory=new c(e,a,e.epBindingInfo,(!0),b),h(),j()}}),e.epCustomizationInfo={kind:"ep-table",id:e.state.id,scope:e,url:a.url(),data:void 0,index:void 0,ctrl:{epBinding:e.epBinding,factory:void 0,columns:e.state.columns},api:{onCustomizeActivate:function(a){e.isCustomizeActive=a===!0,e.activeClass=e.isCustomizeActive?"ep-customize-active":""},onColumnAdd:function(a){e.state.columns.push(a),j(),e.ready=!1,b(function(){e.ready=!0})},onColumnRemove:function(a){e.state.columns=_.without(e.state.columns,a),j(),e.ready=!1,b(function(){e.ready=!0})},onChange:function(a){j(),e.ready=!1,b(function(){e.ready=!0})}}}}}}a.$inject=["$location","$timeout","epBindingFactory","epCustomizationService"],angular.module("ep.binding").directive("epBindingTable",a)}(),function(){"use strict";function a(){function a(a,b,c,d){f.meta[a]={id:a,kind:b,columns:c||{},metadata:d||{}}}function b(a){return f.aliases[a]?f.meta[f.aliases[a]]:f.meta[a]}function c(a,b){f.aliases[b]=f.aliases[a]||a}function d(a){return a&&(f=angular.copy(a)),f}function e(){f={meta:{},aliases:{}}}var f={meta:{},aliases:{}};return{add:a,get:b,addAlias:c,data:d,clear:e}}angular.module("ep.binding").service("epBindingMetadataService",a)}(),function(){"use strict";function a(a){return{restrict:"A",require:"?ngModel",scope:!0,link:function(b,c,d,e){var f;e&&(b.epBindingInfo={value:void 0,kind:"ep-binding-model"},b.$watch(d.epBindingModel,function(c){void 0!==c&&(f?f.changeBinding(c):f=new a(b,c,b.epBindingInfo,(!1),{onValueChanged:function(a){b[d.ngModel]=a}}))}),e.$parsers.unshift(function(a){return b.epBindingInfo.value=a,a}))}}}a.$inject=["epBindingFactory"],angular.module("ep.binding").directive("epBindingModel",a)}(),function(){"use strict";function a(a,b,c){return{restrict:"E",replace:!1,scope:!0,compile:function(d,e){return{pre:function(d){d.trackData=[],d.eventWatches={};var f;d.epBindingInfo={};var g=e.aliasView;d.$watch(e.epBinding,function(a){void 0!==a&&(f?f.changeBinding(a):(f=new c(d,a,d.epBindingInfo,(!1),{onRowChanged:function(a){d[g]=a}},(!0)),g=g||d.epBindingInfo.epBinding.view,d.epb=d.epBindingInfo,d["epb_"+g]=d.epBindingInfo,g&&(d[g]=d.epBindingInfo.record)))}),"true"===e.trackData&&(d.onTrackDataChange=function(a){a===d.epb.viewId&&(d.trackData=[],b(function(){d.trackData=d.epb.view.data()}))},d.eventWatches.view=a.$on("EP_BINDING_VIEW_ADDED",function(a,b){d.onTrackDataChange(b.viewId)}),d.eventWatches.added=a.$on("EP_BINDING_VIEW_ROW_DELETED",function(a,b){d.onTrackDataChange(b.viewId)}),d.eventWatches.view=a.$on("EP_BINDING_VIEW_ROW_ADDED",function(a,b){d.onTrackDataChange(b.viewId)}),d.$on("$destroy",function(){angular.forEach(d.eventWatches,function(a){a()})}))}}}}}a.$inject=["$rootScope","$timeout","epBindingFactory"],angular.module("ep.binding").directive("epBindingScope",a)}(),function(){"use strict";function a(a,b,c,d){var e=function(e,f,g,h,i,j){function k(f){function l(){o.epBinding.column&&(t.value=t.record[o.epBinding.column],s.onValueChanged&&s.onValueChanged(t.value))}function m(a){o.trackBufferRecord&&(t.rec=void 0,b(function(){t.rec=angular.extend({},a),s.onRowChanged&&s.onRowChanged(t.rec)}),p.bufferRecord||(p.bufferRecord=e.$watch("epBindingInfo.rec",function(a,b){if(a&&b&&a!==b)for(var c in a)a.hasOwnProperty(c)&&void 0!==a[c]&&(angular.equals(a[c],b[c])||t.view.columnValue(c,a[c]))},!0)))}function q(a){a&&(t.view=a,t.data=a?a.data():[],s.onViewReady&&s.onViewReady(a),a.hasData()&&r(a))}function r(a){t.record=a.dataRow(),m(t.record),!o.trackBufferRecord&&s.onRowChanged&&s.onRowChanged(t.record),l()}var s=i||{};o={trackBufferRecord:j,scope:e,binding:f,epBinding:c.parseBinding(f),bi:{}};var t=o.bi=g||e.epBindingInfo||{};t.epBinding=o.epBinding,t.columnName=o.epBinding.column,t.viewId=o.epBinding.view,t.view=void 0,t.data=[],t.record=void 0,t.rec=void 0,t.value=void 0,t.rowCount=function(){return t.view&&t.view.hasData()?t.view.data().length:0},t.trx=d.current();var u=d.current().view(o.epBinding.view);p.main||(p.main=a.$on("EP_BINDING_VIEW_ADDED",function(a,c){c.viewId===o.epBinding.view&&("RELOAD"===c.action?(n(),b(function(){k(o.binding)})):q(d.current().view(o.epBinding.view)))})),u&&q(u),p.onViewRowChanged=a.$on("EP_BINDING_VIEW_ROW_CHANGED",function(a,b){b.viewId===o.epBinding.view&&r(b.view)}),o.epBinding.column&&(h!==!0&&(p.bindingValue=e.$watch("epBindingInfo.value",function(a,b){a!==b&&t.record&&o.epBinding.column&&t.view.columnValue(o.epBinding.column,a)})),p.bindingRecord=e.$watch("epBindingInfo.record."+o.epBinding.column,function(a,b){a!==b&&t.record&&o.epBinding.column&&t.record[o.epBinding.column]!==t.value&&l()}))}function l(a){n(),k(a)}function m(){return o.epBinding}function n(){angular.forEach(p,function(a){a()})}var o,p={};return k(f),{epBinding:m,changeBinding:l,freeze:n}};return e}a.$inject=["$rootScope","$timeout","epBindingService","epTransactionFactory"],angular.module("ep.binding").factory("epBindingFactory",a)}(),function(){"use strict";angular.module("ep.binding").filter("epBinding",["epBindingFactory","$log","$rootScope",function(a,b,c){var d="___epBindings",e=function(b,e){e[d]||(e[d]={});var f=e[d][b];return f||(f={column:b,epBindingInfo:{kind:"ep-binding-filter",value:void 0}},e[d][b]=f,f.tempScope=e.$new(!1,e),f.bindingFactory=new a(e,b,f.epBindingInfo,(!0),{onValueChanged:function(a){f.value=a}}),f.eventColumn=c.$on("EP_BINDING_COLUMN_VALUE_CHANGED",function(a,b){b.viewId===f.epBindingInfo.epBinding.view&&(f.epBindingInfo.value=b.newValue)}),f.tempScope.$on("$destroy",function(){f.eventColumn()})),f.epBindingInfo.value};return e}])}(),function(){"use strict";function a(a,b,c,d,e){function f(a){c.showCustomDialog({title:"Data Binding",templateUrl:"src/components/ep.binding/controls/ep-binding-selector.html",icon:"fa fa-cogs fa-2x",binding:"",buttons:[{text:"Ok",action:function(b){a&&a(b.binding)}},{text:"Cancel",isCancel:!0}]})}function g(a){var b;if(!a)return b;if(angular.isString(a)){var c=a.trim();if(b={view:c,column:""},0===c.indexOf("[")&&c.lastIndexOf("]")===c.length-1){var d=c.match(/\[(.*?)\]/g);d.length>1?b={view:d[0].replace("[","").replace("]",""),column:d[1].replace("[","").replace("]","")}:1===d.length&&(b.view=d[0].replace("[","").replace("]",""))}else{var e=c.split(".");e.length&&(b={view:e[0],column:e[1]})}}else b=a;return b}function h(c){c&&!i.onViewRowChanged&&(i.onViewRowChanged=a.$on("EP_BINDING_COMMIT",function(a,c){b.warn("[EP_BINDING_COMMIT] ViewId:"+c.viewId)}),i.onViewRowChanged=a.$on("EP_BINDING_ROLLBACK",function(a,c){b.warn("[EP_BINDING_ROLLBACK] ViewId:"+c.viewId)}),i.onViewRowChanged=a.$on("EP_BINDING_VIEW_ADDED",function(a,c){var d=e.current().view(c.viewId),f="ViewId:"+c.viewId+";Row:"+d.row()+";Count:"+(d.data()?d.data().length:0)+";Action:"+c.action;b.warn("[EP_BINDING_VIEW_ADDED] "+f)}),i.onViewRowDeleted=a.$on("EP_BINDING_VIEW_ROW_ADDED",function(a,c){var d=e.current().view(c.viewId),f="ViewId:"+c.viewId+";Row:"+d.data.row+";Count:"+(d.data()?d.data().length:0);b.warn("[EP_BINDING_VIEW_ROW_ADDED] "+f)}),i.onViewRowDeleted=a.$on("EP_BINDING_VIEW_ROW_DELETED",function(a,c){var d=e.current().view(c.viewId),f="ViewId:"+c.viewId+";Row:"+d.data.row+";Count:"+(d.data()?d.data().length:0);b.warn("[EP_BINDING_VIEW_ROW_DELETED] "+f)}),i.onViewRowChanged=a.$on("EP_BINDING_VIEW_ROW_CHANGED",function(a,c){b.warn("[EP_BINDING_VIEW_ROW_CHANGED] ViewId:"+c.viewId+";Row:"+c.view.row()+";PrevRow:"+c.prevRow)}),i.onViewRowChanged=a.$on("EP_BINDING_COLUMN_VALUE_CHANGED",function(a,c){var d=e.current().view(c.viewId),f=d.__state,g="ViewId:"+c.viewId+";Row:"+c.row+";Orig. Value:"+(c.originalValue||"")+";Old Value:"+c.oldValue+";New value:"+c.newValue+";isDirty:"+d.isDirty()+";hasModified:"+d.hasModified()+";Modified rows:"+Object.keys(f.modifiedRows).length;
b.warn("[EP_BINDING_COLUMN_VALUE_CHANGED] "+g),angular.forEach(f.modifiedRows,function(a){b.info("  row:"+a+";state:"+f.modified[a].state+";columns:"+JSON.stringify(f.modified[a].columns))})})),c||angular.forEach(i,function(a){a()})}var i={};return{selectBinding:f,parseBinding:g,logBindingEvents:h}}a.$inject=["$rootScope","$log","epModalDialogService","epUtilsService","epTransactionFactory"],angular.module("ep.binding").service("epBindingService",a)}(),function(){"use strict";function a(a,b){var c=function(c,d){function e(a,c){L.id=a,L.data=c,L.row=L.data&&L.data.length?0:-1,L.original=b.merge([],L.data),f()}function f(){L.query={},L.isDirty=!1,L.modifiedRows={},L.addedRows={},L.deletedRows=[],L.hasModified=!1,L.hasAdded=!1,L.hasDeleted=!1,L.modified=Array(L.data.length)}function g(){return L.id}function h(){return L.data}function i(a){var b=void 0!==a?a:L.row;if(!(b<0||!L.data||L.data.length<1||b>L.data.length))return L.data[b]}function j(a,b){if(L.data&&!(L.data.length<1))if(angular.isObject(a))for(var c=0;c<L.data.length;c++)L.data[c]===a&&(L.data[c]=b);else a>-1&&a<L.data.length&&(L.data[a]=b)}function k(a){if(L.data&&!(L.data.length<1)){var b=-1;if(angular.isObject(a))for(var c=0;c<L.data.length;c++)L.data[c]===a&&(b=c);else b=a;return b>-1&&b<L.data.length?L.modified[b]:void 0}}function l(){return L.data&&L.data.length}function m(b){if(void 0!==b){var c=L.row;L.row=b,a.$emit("EP_BINDING_VIEW_ROW_CHANGED",{viewId:L.id,view:this,prevRow:c})}return L.row}function n(b){var c=K(b);return c!==-1&&(void 0!==L.addedRows[c]?(delete L.deletedRows[c],delete L.addedRows[c],L.hasAdded=Object.keys(L.addedRows).length>0):(L.deletedRows[L.deletedRows.length]=L.data[c],o(c)),L.data.splice(c,1),L.isDirty=!0,L.hasDeleted=Object.keys(L.deletedRows).length>0,a.$emit("EP_BINDING_VIEW_ROW_DELETED",{viewId:L.id,view:this,row:c})),c}function o(a){var b=L.addedRows;angular.forEach(Object.keys(b),function(b){b>a&&(L.addedRows[b-1]=L.addedRows[b-1],delete L.addedRows[b])})}function p(b,c){angular.isArray(L.data)||(L.data=[]),L.data.push(b);var d=L.data.length-1;return L.addedRows[d]=d,L.hasAdded=!0,a.$emit("EP_BINDING_VIEW_ROW_ADDED",{viewId:L.id,view:this,row:d}),c===!0&&this.row(d),d}function q(a){var b=void 0===a?L.row:a;if(void 0===L.addedRows[b])return angular.forEach(Object.keys(L.addedRows),function(a){a<b&&b++}),angular.forEach(Object.keys(L.deletedRows),function(a){a<b&&b--}),b}function r(b,c){var d=L.row,e=L.data[d];if(arguments.length>1){var f=e[b];if(e[b]!==c){e[b]=c,L.isDirty=!0;var g="";if(void 0===L.addedRows[d]&&void 0===L.deletedRows[d]){var h=L.modified[d]||{state:"M",columns:{}},i=q(d);void 0!==i&&(g=L.original[i][b]),Object.keys(h.columns).length>0&&e[b]===g?delete h.columns[b]:h.columns[b]=c,h.state=Object.keys(h.columns).length>0?"M":"",L.modified[d]=""===h.state?void 0:h,L.modifiedRows[d]=d,""===h.state&&delete L.modifiedRows[d],L.hasModified=Object.keys(L.modifiedRows).length>0}a.$emit("EP_BINDING_COLUMN_VALUE_CHANGED",{viewId:L.id,row:L.row,newValue:c,oldValue:f,Value:g})}}return e[b]}function s(a,b){this.columnValue(a,b)}function t(a){return this.columnValue(a)}function u(){L.data=b.merge([],L.original),f(),a.$emit("EP_BINDING_ROLLBACK",{viewId:L.id})}function v(){L.original=b.merge([],L.data),f(),a.$emit("EP_BINDING_COMMIT",{viewId:L.id})}function w(){return L.hasModified}function x(){return L.isDirty}function y(){var a=[];return angular.forEach(Object.keys(L.modifiedRows),function(b){a.push(L.data[b])}),a}function z(a){var b=void 0===a?L.row:a;return void 0!==L.modified[b]&&"M"===L.modified[b].state}function A(){var a=[];return angular.forEach(Object.keys(L.addedRows),function(b){a.push(L.data[b])}),a}function B(){var a=y().concat(A());return a}function C(){var a=[];return angular.forEach(L.deletedRows,function(b){a.push(b)}),a}function D(){return L.hasAdded}function E(){return L.hasDeleted}function F(){return L.hasAdded||L.hasModified||L.hasDeleted}function G(a,b,c){if(L.data&&L.data.length&&a)for(var d=0;d<L.data.length;d++){var e=L.data[d];if(a(e))return b&&this.row(d),c===!0?d:e}if(c===!0)return-1}function H(a,b){return a&&(b===!0?angular.merge(L.userData,a):L.userData=a),L.userData||{}}function I(a){return a&&(L.query=a),L.query}function J(a){e(this.id(),a||[])}function K(a){var b=-1;if(!L.data||L.data.length<1)return b;if(angular.isObject(a)){for(var c=0;c<L.data.length;c++)if(L.data[c]===a)return c}else b=a;return b>-1&&b<L.data.length?b:-1}var L={userData:{}};return e(c,d),{__state:L,id:g,reload:J,data:h,dataRow:i,row:m,columnValue:r,set:s,get:t,addRow:p,deleteRow:n,isDirty:x,hasData:l,hasModified:w,hasAdded:D,hasDeleted:E,hasChanges:F,modifiedRows:y,modifiedState:k,addedRows:A,deletedRows:C,changedRows:B,rowModified:z,findRow:G,replaceDataRow:j,rollback:u,commit:v,userData:H,query:I}};return c}a.$inject=["$rootScope","epUtilsService"],angular.module("ep.binding").factory("epDataViewFactory",a)}(),function(){"use strict";function a(a,b,c){function d(a){return new g(a)}function e(){return f||(f=d("default")),f}var f,g=function(d){function e(){return m}function f(c,d){var e="CREATE",f=this.view(c);return f?(f.reload(d),e="RELOAD"):f=n[c]=new b(c,d),a.$emit("EP_BINDING_VIEW_ADDED",{viewId:c,action:e}),f.data()&&f.data().length&&a.$emit("EP_BINDING_VIEW_ROW_CHANGED",{viewId:f.id(),view:f}),n[c]}function g(a){return n[a]}function h(){var a=[];return angular.forEach(n,function(b,c){a.push(c)}),a}function i(){var a=[];return angular.forEach(n,function(a){a.rollback()}),a}function j(a,b,d){var e=this.view(a);if(e){if(d||(d={}),"data"===d.data)this.add(b,e.data());else if("record"===d.data){var f=e.dataRow();this.add(b,f?[f]:[])}else"none"===d.data?this.add(b,[]):this.add(b,[]);var g=c.get(a);g&&c.addAlias(a,b)}}function k(a){this.view(a)&&delete n[a]}function l(){n={}}var m=d,n={};return{id:e,add:f,clone:j,remove:k,clear:l,view:g,views:h,rollback:i}};return{current:e,newTransaction:d}}a.$inject=["$rootScope","epDataViewFactory","epBindingMetadataService"],angular.module("ep.binding").factory("epTransactionFactory",a)}(),function(){"use strict";function a(a,b,c,d,e,f){function g(a){var d="Ice.BO.BAQDesignerSvc/BAQDesigners",f=e.setSelect(["QueryID","Company","IsShared","Version","Updatable","SysRevID"]);a&&(f=f.setWhereCustom("startswith(QueryID,'"+a+"')")),f=f.compose();var g=b.get(d,f).$promise;return g.then(function(a){a.value},function(a){var b=a["odata.error"]?a["odata.error"].message.value:a.statusText;c.showException({title:"Exception",message:b})}),g}function h(e,g,h,i){i||(i={});var j=i.showProgress!==!1;j&&c.showProgress({title:i.title||"Retrieving BAQ data",message:i.message||"retrieving data from server...",showProgress:!0});var n=a.defer(),o=g;g&&g.compose&&(o=g.compose());var p="BaqSvc/"+e,q=b.get(p,o).$promise;q.then(function(a){},function(a){var b=l(a);n.reject(b,a)});var r;return f.get(h)||(r=k(e),r.then(function(a){var b=m(a.data.returnObj);f.add(h,"baq",b)},function(a){})),a.all([q,r]).then(function(a){var b=a[0].value;if(b){if(i.convertToJsonType!==!1){var g=f.get(e);g&&g.columns&&angular.forEach(g.columns,function(a){if(a&&"decimal"===a.dataType)for(var c=0;c<b.length;c++){var d=b[c][a.name];angular.isString(d)&&d.length&&(b[c][a.name]=parseFloat(d))}})}var k=d.current().add(h,b);k&&k.query({filter:o?o.$filter:""})}j&&c.hide(),n.resolve(a[0])}),n.promise}function i(g,i,j){j||(j={});var k=j.showProgress!==!1,m=function(){k&&c.hide()},n=a.defer();try{k&&c.showProgress({title:j.title||"Updating data",message:j.message||"sending data to server...",showProgress:!0});var o="BaqSvc/"+g,q=angular.copy(i);if(j.convertToJsonType!==!1){var r=f.get(g);r&&r.columns&&angular.forEach(Object.keys(q),function(a){var b=r.columns[a];if(b&&"decimal"===b.dataType&&!angular.isString(q[a])){var c=""+q[a];q[a]=c}})}q.hasOwnProperty("$$hashKey")&&delete q.$$hashKey;var s=q;if(j.updatableOnly!==!1){var r=f.get(g);if(r&&r.columns){s=angular.copy(q);var t=_.filter(r.columns,function(a){return a.updatable!==!0&&a.isKeyField!==!0&&"SysRowID"!==a.name&&a.name.indexOf("_")!==-1});angular.forEach(t,function(a){delete s[a.name]}),s&&s.length<1&&(s=q)}}var u=b.patch(o,s);u.then(function(){var a,b,c=j.viewId;if(j.retrieve&&j.retrieve.viewId&&(c=j.retrieve.viewId),j.retrieve&&c){if(j.retrieve.keys&&j.retrieve.keys.length)b=j.retrieve.keys;else{var f=p(g);f&&f.length>0&&(b=f)}if(b){var a=e;angular.forEach(b,function(b){a=a.setWhere(b,"eq",q[b])})}}if(a){var k=g+"__temp";h(g,a,k,void 0).then(function(){m();var a=d.current().view(k),e=i,f=d.current().view(c);if(a.hasData()&&f){e=a.dataRow();var g=f.findRow(function(a){var c=!0;return angular.forEach(b,function(b){a[b]!==i[b]&&(c=!1)}),c},!0);g&&f.replaceDataRow(g,a.dataRow())}d.current().remove(k),n.resolve(e)})}else m(),n.resolve(i)}),u.error(function(a){m(),l(a),n.reject(a)})}catch(v){l(response),m()}return n.promise}function j(a,e,f){f||(f={});var g=f.showProgress!==!1;g&&c.showProgress({title:"Retrieving BAQ data",message:"getting new record from server...",showProgress:!0});var h="BaqSvc/"+a+"/GetNew",i=b.get(h,"").$promise;return i.then(function(a){if(g&&c.hide(),a.value){var b=0,h=d.current().view(e);h?b=h.addRow(a.value[0]):h=d.current().add(e,a.value),f&&f.setCurrentRow!==!0||h.row(b)}},function(a){g&&c.hide(),l(a)}),i}function k(a,c){var d="Ice.BO.BAQDesignerSvc/GetByID",e={queryID:a},g=b.post(d,e);return g.then(function(b){if(c){var d=m(b.data.returnObj);f.add(c,"baq",d),a!==c&&f.addAlias(c,a)}}),g.error(function(a){l(a)}),g}function l(a){var b=a.ErrorMessage||"";return!b&&a["odata.error"]&&(b=a["odata.error"].message.value),!b&&a.statusText&&(b=a.statusText),!b&&a.message&&(b=a.message),c.showException({title:"Info",message:b||"",messageDetails:angular.toJson(a,2)}),b}function m(a){var b={};return angular.forEach(a.QueryFieldDesigner,function(c){var d=_.find(a.QueryUpdateFieldDesigner,function(a){return c.QueryID===a.QueryID&&c.TableID===a.MapTableName&&c.FieldName===a.MapFieldName}),e=!!d,f=e&&d.IsKeyField===!0;b[c.Alias]={name:c.Alias,caption:c.FieldLabel||c.Alias,updatable:c.Updatable,required:c.IsRequired,requiredFlag:c.IsRequired,tableId:c.TableID,columnName:c.FieldName,dataType:c.DataType,editor:n(c),hasUpdateMapping:e,isKeyField:f},c.FieldFormat&&o(c,b[c.Alias])}),b}function n(a){var b="auto",c=(a.DataType||"").toLowerCase();return"bool"===c||"boolean"===c||"logical"===c||"bit"===c?b="checkbox":"date"===c||"datetime"===c||"system.datetime"===c?b="date":"byte"===c||"int32"===c||"integer"===c||"decimal"===c||"system.decimal"===c||"system.int32"===c?b="number":"nvarchar"===c&&(b="text"),b}function o(a,b){if(a.FieldFormat){var c=a.FieldFormat.trim().toLowerCase();if(c&&0===c.indexOf("x(")&&c.endsWith(")")){var d=c.substr(2,c.length-3),e=parseInt(d);if(!isNaN(e)){b.maxLength=e;var f=90;b.maxLength>=f&&(b.editor="multiline")}}}}function p(a,b){var c=[],d=f.get(a);return d&&d.columns&&angular.forEach(d.columns,function(a){a.isKeyField&&(b?c.push({name:a.name,value:b[a.name]}):c.push(a.name))}),c}return{getBAQList:g,getBAQ:h,updateBAQ:i,getNewBAQ:j,getBAQDesigner:k}}a.$inject=["$q","epErpRestService","epModalDialogService","epTransactionFactory","odataQueryFactory","epBindingMetadataService"],angular.module("ep.erp").service("epErpBaqService",a)}(),function(){"use strict";function a(a,b,c,d,e){function f(f,g,i,j){j||(j={});var k=j.showProgress!==!1;k&&c.showProgress({title:"Retrieving data",message:"retrieving data from server...",showProgress:!0});var l=a.defer(),m=b.get(f,g).$promise;m.then(function(a){},function(a){var b=h(a);l.reject(b,a)});var n;if(j.retrieveMetadata===!0){var o=f.indexOf("/"),p=f.substr(0,o);e.get(p)||(n=b.get("/api/swagger/v1/odata/"+p,"").$promise,n.then(function(a){a&&e.add(p,"swagger",void 0,a)},function(a){h(a),l.reject(msg,a)}))}return a.all([m,n]).then(function(a){var b=a[0].value;if(b){if(j.convertToJsonType!==!1){var f=e.get(i);f&&f.columns&&angular.forEach(f.columns,function(a){if(a&&"decimal"===a.dataType)for(var c=0;c<b.length;c++){var d=b[c][a.name];angular.isString(d)&&d.length&&(b[c][a.name]=parseFloat(d))}})}d.current().add(i,b)}k&&c.hide(),l.resolve(a[0])}),l.promise}function g(a,d,f,g){g||(g={});var i=g.showProgress!==!1;i&&c.showProgress({title:g.title||"Updating data",message:g.message||"sending data to server...",showProgress:!0});var j=angular.copy(d);if(g.convertToJsonType!==!1){var k=e.get(f);k&&k.columns&&angular.forEach(Object.keys(j),function(a){var b=k.columns[a];if(b&&"decimal"===b.dataType&&!angular.isString(j[a])){var c=""+j[a];j[a]=c}})}j.hasOwnProperty("$$hashKey")&&delete j.$$hashKey;var l=a,m=b.post(l,j);return m.then(function(){i&&c.hide()}),m.error(function(a){i&&c.hide(),h(a)}),m}function h(a){var b=a.ErrorMessage||"";!b&&a["odata.error"]&&(b=a["odata.error"].message.value),!b&&a.statusText&&(b=a.statusText),c.showException({title:"Info",message:b||"",messageDetails:angular.toJson(a,2)})}return{getSvc:f,updateSvc:g}}a.$inject=["$q","epErpRestService","epModalDialogService","epTransactionFactory","epBindingMetadataService"],angular.module("ep.erp").service("epErpSvcService",a)}(),angular.module("ep.templates").run(["$templateCache",function(a){"use strict";a.put("src/components/ep.token/ep-login-view/ep-login-view.html",'<!--This is a partial for the ep-login-view directive --><div class="ep-login-view container-fluid"><div class=ep-login-background><div class=ep-background-image ng-if=!settings.customImage></div><img class=ep-background-custom-image ng-if=settings.customImage ng-src={{settings.customImage}} alt=""></div><div class=ep-login-up-box><div class="ep-login-box center-block"><form class=form-group><div class=form-group><p class=ep-login-text><b>Please enter your credentials to sign in.</b></p><div class=input-group><span class=input-group-addon><i class="fa fa-user fa-fw"></i></span> <input clearable name=username ng-keypress=clearWarning() id=username class=form-control ng-model=settings.username placeholder="User Name"></div><br><div class=input-group><span class=input-group-addon><i class="fa fa-lock fa-fw"></i></span> <input type=password clearable ng-keypress=passwordKeyPress($event) name=password id=password class=form-control ng-model=settings.password placeholder="Password"></div><br><div ng-show=showServerName class=input-group><span class=input-group-addon><i class="fa fa-server fa-fw"></i></span> <input spellcheck autocorrect=false clearable name=servername id=serverValue class=form-control ng-model=settings.serverName placeholder="Server"></div><br><div ng-if=status class="text-center alert alert-warning"><label>{{status}}</label><br></div><div><button ng-if="options.showSettingsButton !== false" class="btn btn-default pull-left" ng-click=showServer()><i class="fa fa-cog fa-fw"></i></button> <button type=submit class="btn btn-primary pull-right" ng-click=loginUser()>Log in</button></div></div></form></div></div></div>'),a.put("src/components/ep.token/ep-login/login.html",'<div class=thumbnail><div ng-if="showTitle !== false" class=caption><h3 ng-hide=hasToken><span class="icon icon-enter"></span> Login</h3><h3 ng-show=hasToken><span class="icon icon-exit"></span> Logout</h3><hr></div><form role=form><div ng-if="showLabels === false" class=input-group><span class=input-group-addon><i class="fa fa-user fa-fw"></i></span> <input tabindex=1 id=user-name name=username required class=form-control ng-model=user.username placeholder="user name"></div><div ng-if="showLabels !== false" class=form-group><label for=user-name class="col-sm-2 control-label">User:</label><div><input tabindex=1 id=user-name name=username required class=form-control ng-model=user.username placeholder="user name"></div></div><div ng-if="showLabels === false" class=form-group><div class=input-group><span class=input-group-addon><i class="fa fa-key fa-fw"></i></span> <input tabindex=2 id=user-password name=password required class=form-control type=password placeholder=password ng-model="user.password"></div></div><div ng-if="showLabels !== false" class=form-group><label for=user-password class="col-sm-2 control-label">Password:</label><div><input tabindex=2 id=user-password name=password required class=form-control type=password placeholder=password ng-model="user.password"></div></div></form><div class="alert alert-danger" id=validationSummary role=alert ng-show=hasError>{{status}}</div><div><button ng-if="showCancel !== false" type=button class="btn btn-default" ng-click=cancel()>Cancel</button> <button type=button class="btn btn-primary" ng-hide=hasToken ng-click=login()>Login</button> <button type=button class="btn btn-primary" ng-show=hasToken ng-click=logout()>Logout</button></div></div>'),a.put("src/components/ep.search/search.html",'<div><header class=reverse><div class=searchControl><form role=form ng-submit=runSearch(searchText)><input type=search placeholder="Enter your search terms..." ng-model=searchText ng-change="changeSearch()"> <span class=input-group-btn><button class="btn btn-default" type=button><span class="icon icon-search"></span></button></span> <button ng-click=runSearch(searchText) ng-disabled=!searchText>search</button></form><div class="alert alert-danger" id=validationSummary role=alert ng-show=hasError>{{status}}</div></div></header><section><div ng-show=enterpriseSearch.searchText><p ng-show=enterpriseSearch.searching>Searching for the following terms: \'{{enterpriseSearch.searchText}}\' ...</p><p ng-show=enterpriseSearch.searchError>{{enterpriseSearch.searchError}}</p></div><ul ng-if=enterpriseSearch.searchResults class=searchResults><li ng-repeat="searchResult in enterpriseSearch.searchResults track by $index" class=searchResultCategory><b>Category: {{searchResult.label | uppercase}}</b><br><ul ng-if=searchResult.results><li ng-repeat="result in searchResult.results" class=searchResult><span class=searchResultHeader ng-class=searchResult.label>{{result.label | uppercase}} - {{result.companyContext}} - {{result.keyTag}}</span><br><div ng-if=result.fields><span ng-repeat="field in result.fields" class=searchResultField>{{field.alias}}: {{field.FieldValue}},</span></div></li></ul></li></ul></section></div>'),a.put("src/components/ep.table/table.html",'<table class=table ng-class="{\'table-striped\' : striped}"><tr><th ng-repeat="oneTh in headers track by $index">{{oneTh}}</th></tr><tr ng-show=isLoading><td colspan={{colCount}}><div class="progress progress-striped active"><div class=progress-bar role=progressbar aria-valuenow=1 aria-valuemin=0 aria-valuemax=1 style="width: 100%"></div></div></td></tr><tr ng-show=loadError><td colspan={{colCount}}><p class="text-danger text-center"><i class="fa fa-exclamation-triangle"></i> {{loadError}}</p></td></tr><tr ng-repeat="row in data" class=ep-table-row ng-class="{ \'info\': row.$isSelected }" ng-click=selectRow(row,$event) ng-dblclick=onDblClick(row,$event)><td ng-repeat="cell in props track by $index" class=ep-table-cell>{{row[cell]}}</td></tr></table>'),a.put("src/components/ep.binding/controls/ep-binding-editor.html","<ep-editor-control drag-enabled=false column=state.column value=epBindingInfo.value is-row=isRow></ep-editor-control>"),a.put("src/components/ep.binding/controls/ep-binding-label.html",'<div class="ep-binding-label {{labelClass}}"><label for={{forCtrl}}>{{state.label}}<span ng-if="state.requiredFlag && required !== false" class="ep-required-indicator text-danger fa fa-asterisk"></span></label></div>'),a.put("src/components/ep.binding/controls/ep-binding-pagination.html","<!--This is a partial for the ep-binding directive --><div class=ep-binding><uib-pagination previous-text=&lsaquo; next-text=&rsaquo; items-per-page=1 total-items=totalItems ng-model=currentPage ng-change=onPageChange() max-size=maxSize class=pagination-sm boundary-link-numbers=true rotate=false></uib-pagination></div>"),a.put("src/components/ep.binding/controls/ep-binding-record-editor.html","<ep-binding-scope ep-binding=epBinding><ep-record-editor options=options record=epb.rec isreadonly=readonly size-class=sizeClass on-init=onInitThis(factory) class={{activeClass}}></ep-record-editor></ep-binding-scope>"),a.put("src/components/ep.binding/controls/ep-binding-selector.html",'<!--This is a partial for the ep-binding directive --><div class=ep-binding-selector ng-controller=epBindingSelectorCtrl><div class="panel panel-default"><div class="panel-heading panel-heading-small"><ul class="nav nav-tabs"><li class=active><a data-toggle=pill href=.binding>Binding</a></li><li><a data-toggle=pill href=.preview>Data Preview</a></li></ul></div><div class=panel-body><div class="tab-content ep-padding-bottom"><div class="binding tab-pane fade in active"><ep-editor-control column=viewList value=meta.view></ep-editor-control><div ng-if=meta.view><div class=text-center ng-show=loadingColumns><i class="fa fa-spinner fa-spin fa-2x"></i><label>loading columns...</label></div><div ng-hide=loadingColumns><ep-editor-control column=columnList value=meta.column></ep-editor-control></div></div><ep-editor-control column=columnBinding value=config.binding></ep-editor-control></div><div class="preview tab-pane fade"><textarea class="form-control alert-info" ng-model=meta.preview style="min-height: 400px; min-width: 300px"></textarea><div><a ng-show="isAllDataPreview !== true" ng-click=showAllData(true) style="margin-right: 15px"><i></i>Show All</a> <a ng-show="isAllDataPreview === true" ng-click=showAllData(false) style="margin-right: 15px"><i></i>Show Current Record</a></div></div><div class="preview tab-pane fade"><textarea class="form-control alert-info" ng-model=meta.info style="min-height: 400px; min-width: 300px"></textarea></div></div></div></div></div>'),a.put("src/components/ep.binding/controls/ep-binding-table.html","<ep-table ng-if=ready data=state.data track-selected-row=trackSelectedRow column-headers={{headers}} column-properties={{dataColumns}} striped=true class={{activeClass}} on-select-row=onSelectRow($row) on-double-click-row=dblClickRow($row)></ep-table>"),a.put("src/components/ep.binding/ep-binding.html","<!--This is a partial for the ep-binding directive --><div class=ep-binding></div>")}]);