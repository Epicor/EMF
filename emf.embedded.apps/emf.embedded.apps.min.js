/*
 * emf (Epicor Mobile Framework) 
 * version:1.0.12-dev.70 built: 18-03-2017
*/
if("undefined"==typeof __ep_build_info)var __ep_build_info={};__ep_build_info["embedded.apps"]={libName:"embedded.apps",version:"1.0.12-dev.70",built:"2017-03-18"},angular.module("ep.embedded.apps",["ep.templates","ep.sysconfig","ep.utils"]),angular.module("ep.embedded.apps").directive("epEmbeddedAppsHref",["$log","epEmbeddedAppsService",function(a,b){return{restrict:"A",scope:{},link:function(c,d,e){function f(){c.clickHandler=d.bind("click",function(){b.goToView(e.epHrefAppId,e.epHref)}),c.$on("$destroy",function(){d.unbind("click",c.clickHandler)})}if("A"===d[0].tagName||"BUTTON"===d[0].tagName)if("A"===d[0].tagName&&e.$set("href",""),e.epHrefAppId)f();else for(var g=Object.keys(b.configs),h=0;h<g.length;h++){var i=b.configs[g[h]];if(i.isRunning){e.$set("epHrefAppId",i.id),f();break}}else a.warn("ep-embedded-apps-href can only be used on an <a> or <button> tag")}}}]),function(){"use strict";function a(a,b,c,d,e,f,g,h){return{scope:{config:"=",onComplete:"&"},link:function(i,j){function k(){m&&(m.$destroy(),m=null),j.html("")}function l(d){var h,i=c.defer(),j="view:"+d;return g.scriptCache.get(j)?(h=g.scriptCache.get(j),e(function(){i.resolve(h)},0)):a.get(d,{cache:f}).then(function(a){g.scriptCache.put(j,a.data),i.resolve(a.data)},function(a){b.error('Error loading template "'+d+'": '+a),i.reject(a)}),i.promise}var m;i.$watch("config.id",function(){var a=i.config;a&&a.id?h.load(a).then(function(){var b=a.activeViewId||a.startViewId,c=h.getAppPath(a.id,a.views[b].templateUrl);return l(c)}).then(function(a){m=i.$new(),j.html(a);var b=j.contents(),c=d(b);c(m),i.onComplete&&i.onComplete()}):k()})}}}a.$inject=["$http","$log","$q","$compile","$timeout","$templateCache","epEmbeddedAppsCacheService","epEmbeddedAppsProvider"],angular.module("ep.embedded.apps").directive("epEmbeddedAppsLoader",a)}(),angular.module("ep.embedded.apps").service("epEmbeddedAppsShellService",["$rootScope","$location","$log","$timeout","epEmbeddedAppsConstants","epEmbeddedAppsProvider","epUtilsService",function(a,b,c,d,e,f,g){function h(a){f.state&&f.state.loadComplete?a():d(function(){h(a)},250)}function i(){n=g.getService("epShellService"),n&&(a.$on(e.CONFIG_LOADED_EVENT,function(a,b){o=b.goToView,l(b.configs)}),a.$on(e.APPLICATION_LOADED_EVENT,function(a,b){var c=b.scope,d=c.appConfig;d.name&&n.setPageTitle(d.name),n.saveState(),j(c,d)}),a.$on(e.APPLICATION_EXIT_EVENT,function(){n.restoreState()}),a.$on(e.VIEW_LOADED_EVENT,function(a,b){var c=b.scope,d=c.appConfig,e=d.views[b.viewId];e&&h(function(){k(c,d,e)})}))}function j(a,c){if(c.epShellNavBar&&(c.epShellNavBar.hideHostButtons&&n.updateNavbarButtons([]),c.epShellNavBar.closeButton)){var d=c.epShellNavBar.closeButton;n.addNavbarButtons([{id:d.id||"ep.embedded.app_closeApp",title:d.title||"Close application and return home.",icon:d.icon||"fa-times",action:function(){b.url("/home")}}])}}function k(a,b,c){if(c.sidebarOptions&&!c.sidebarSettings&&(c.sidebarSettings=c.sidebarOptions),c.sidebarSettings){if(n.disableLeftSidebar(),c.sidebarSettings.left)if(n.enableLeftSidebar(),c.sidebarSettings.left.templateUrl){var d=a.embeddedAppsService.getAppPath(b.id,c.sidebarSettings.left.templateUrl);n.setLeftTemplate("<div ng-include=\"'"+d+"'\"></div>")}else c.sidebarSettings.left.template&&n.setLeftTemplate(c.sidebarSettings.left.template);if(n.disableRightSidebar(),c.sidebarSettings.right)if(n.enableRightSidebar(),c.sidebarSettings.right.templateUrl){var e=a.embeddedAppsService.getAppPath(b.id,c.sidebarSettings.right.templateUrl);n.setRightTemplate("<div ng-include=\"'"+e+"'\"></div>")}else c.sidebarSettings.right.template&&n.setRightTemplate(c.sidebarSettings.right.template)}else n.disableLeftSidebar(),n.disableRightSidebar();if(c.viewSettings){var g=c.viewSettings,h=f.getAppRoute(b.id,b.startViewId);g.small&&(b.startupInShell&&!g.small.brandTarget&&(g.small.brandTarget=h),angular.forEach(g.small,function(a,b){n.__state.viewSettings.small[b]=a})),g.large&&(b.startupInShell&&!g.large.brandTarget&&(g.large.brandTarget=h),angular.forEach(g.large,function(a,b){n.__state.viewSettings.large[b]=a})),g.small||g.large||(b.startupInShell&&!g.brandTarget&&(g.brandTarget=h),angular.forEach(g,function(a,b){n.__state.viewSettings.small[b]=a,n.__state.viewSettings.large[b]=a})),n.__setCurrentModeFlags()}}function l(a){var b;n.isHomeLocation()&&(a&&angular.forEach(a,function(a){if(a.epShellNavBar&&a.epShellNavBar.applicationButton){var c=a.epShellNavBar.applicationButton;n.addNavbarButtons([{id:"ep.embedded.app_"+a.id,title:c.title||a.name,icon:c.icon||a.icon,action:function(){o(a.id)}}])}a.startupInShell&&(b=a)}),b&&o(b.id))}function m(){}var n,o;return d(function(){i()}),{initialize:m,setupShellConfigs:l}}]),angular.module("ep.embedded.apps").constant("epEmbeddedAppsConstants",{CONFIG_LOADED_EVENT:"EMBEDDED_CONFIG_LOADED_EVENT",APPLICATION_LOADED_EVENT:"EMBEDDED_APPLICATION_LOADED_EVENT",VIEW_LOADED_EVENT:"EMBEDDED_VIEW_LOADED_EVENT",APPLICATION_EXIT_EVENT:"EMBEDDED_APPLICATION_EXIT_EVENT"}),angular.module("ep.embedded.apps").directive("epEmbeddedApps",["$document","$log","$rootScope","$routeParams","$location","$timeout","epEmbeddedAppsService","epEmbeddedAppsCacheService","epEmbeddedAppsConstants",function(a,b,c,d,e,f,g,h,i){return{restrict:"E",templateUrl:"src/components/ep.embedded.apps/embedded-apps.html",link:function(j){function k(k){var m=g.configs[k];if(m){var n;if(n=l.viewId?m.views[l.viewId]:m.views[m.startViewId],n&&(n.parent=m,m.activeViewId=l.viewId,j.currentView=n,n.routeParams)){var o=n.routeParams.split("/").map(function(a){return a.substring(1,a.length)}),p=0;angular.forEach(o,function(a){a&&(d[a]=d["p"+p],delete d["p"+p],p++)})}if(!m.initialized&&m.splash){f(function(){j.showSplash=!0}),j.showApp=!1;var q=new Date;j.onLoaderComplete=function(){var a=Math.max(2e3-(new Date-q),0);m.initialized=!0,f(function(){j.showSplash=!1,j.showApp=!0,j.$apply()},a)}}else j.showApp=!0,m.onComplete=null,m.initialized=!0;if(j.appConfig=m,j.embeddedAppsService=g,m.isRunning!==!0){m.isRunning=!0;var r=g.getAppRoute("");m.locationHdl||(m.locationHdl=c.$on("$locationChangeStart",function(){m.locationHdl&&0!==e.url().indexOf(r)&&(c.$on("$destroy",m.locationHdl),m.locationHdl=null,m.isRunning=!1,c.$emit(i.APPLICATION_EXIT_EVENT,{scope:j,viewId:l.viewId}),m.resources.links.forEach(function(c,d){var e="link_"+d,f=a[0].getElementById(e);f&&(a[0].getElementsByTagName("head")[0].removeChild(f),b.debug("Unloading link: "+c)),h.linkCache.remove(e)}),f(function(){j.$apply()}))})),f(function(){j.$emit(i.APPLICATION_LOADED_EVENT,{scope:j,viewId:l.viewId}),j.$apply()})}f(function(){j.$emit(i.VIEW_LOADED_EVENT,{scope:j,viewId:l.viewId}),j.$apply()})}}var l=g.state;j.showSplash=!1,c.$watch(function(){return g.state.loadComplete},function(a){a&&(l.appId=d.appId,d.viewId&&(l.viewId=d.viewId),k(l.appId))})}}}]),angular.module("ep.embedded.apps").service("epEmbeddedAppsCacheService",["$cacheFactory",function(a){var b=a("scriptCache",{capacity:200}),c=a("linkCache",{capacity:200});return{scriptCache:b,linkCache:c}}]).provider("epEmbeddedAppsProvider",["$controllerProvider","$provide","$compileProvider","$filterProvider",function(a,b,c,d){function e(a){try{angular.module(a)}catch(b){if(/No module/.test(b))return!1}return!0}function f(a){var b=[];return angular.forEach(a.requires,function(a){l.indexOf(a)===-1&&b.push(a)}),b}function g(a,b,c){var d,e,f;for(f=b,d=0,e=b.length;d<e;d++){var g,h=b[d];if(!c.hasOwnProperty(h[0]))return a.error("unsupported provider "+h[0]);g=c[h[0]];var i=g[h[1]],j=h[2];i.apply(g,j)}}function h(a,b,c,d){var e,h,i;if(d){var j=[],k=[];for(m.hostAppModule&&(k=f(angular.module(m.hostAppModule))),c.$injector=b,e=d.length-1;e>=0;e--){if(h=d[e],angular.moduleRequiresLoading[h]||k.length&&k.indexOf(h)===-1){l.push(h),i=angular.module(h),j=j.concat(i._runBlocks);try{g(a,i._invokeQueue,c),g(a,i._configBlocks,c)}catch(n){throw n.message&&(n.message+=" from "+h),a.error(n.message),n}angular.moduleRequiresLoading[h]=!1}d.pop()}angular.forEach(j,function(c){try{b.invoke(c)}catch(d){a.error(d)}})}return null}function i(){var a=_.flatten(arguments,!0),b=m.path;return angular.forEach(a,function(a){b+="/"+a}),b}function j(){var a=_.flatten(arguments,!0),b="/"+m.rootRoute;return angular.forEach(a,function(a){b+="/"+a}),b}function k(a,b){return q=a,["$location",function(a){function c(){return i(q.id,arguments)}function d(){return j(q.id,arguments)}function e(b){a.url(d(b))}function f(a,c,d,e,f){if(void 0!==e&&null!==e&&!f&&h[e])return b(function(){return h[e]})}function g(){return q}var h={},k={get:function(a,b,c){return f("get",a,"",b,c)},post:function(a,b,c,d){return f("post",a,b,c,d)},put:function(a,b,c,d){return f("put",a,b,c,d)},"delete":function(a,b,c,d){return f("delete",a,"",c,d)}};return{getConfig:g,resource:k,data:h,goToView:e,getAppPath:c,getAppRoute:d}}]}var l=["ng"],m={rootRoute:"app",path:"apps",provider:"sysconfig",applications:[],hostAppModule:""},n={},o={$controllerProvider:a,$compileProvider:c,$filterProvider:d,$provide:b},p=[];p.push=function(a){this.indexOf(a)===-1&&Array.prototype.push.apply(this,arguments)};var q,r={loadComplete:!1};this.$get=["$timeout","$document","$http","$injector","$log","$q","epEmbeddedAppsCacheService","epSysConfig","epUtilsService",function(a,b,c,d,g,s,t,u,v){function w(j){function m(c,d){c.forEach(function(c,e){var f="link_"+e;if(c&&!t.linkCache.get(f)){var g=b[0].createElement("link");g.setAttribute("id",f),g.rel="stylesheet",g.href=c,g.type="text/css",b[0].head.appendChild(g),t.linkCache.put(f,1),a(function(){d("Link: "+c)})}})}function u(a,b,c){function d(b){function c(){e--,e<1&&d.resolve()}var d=s.defer(),e=b.length;return 0===e&&d.resolve(),b.forEach(function(b){v.loadScript(b,t.scriptCache).then(function(b){a(b)}).then(c,c)}),d.promise}r.loadComplete=!1,function(a){angular.moduleRequiresLoading={},angular.module=function(){return arguments.length>1&&(angular.moduleRequiresLoading[arguments[0]]=!0),a.apply(null,arguments)}}(angular.module);var e=(j.resources.scripts.thirdParty||[]).map(function(a){return i(j.id,a)});d(e).then(function(){var b=j.resources.scripts.module;if(b)return v.loadScript(i(j.id,b),t.scriptCache).then(function(b){a(b)})}).then(function(){var a=j.resources.scripts.app.map(function(a){return i(j.id,a)});return d(a)}).then(c);var f=j.resources.links.map(function(a){return i(j.id,a)});m(f,b)}function w(b,c){function d(d){if(d){var e=i.indexOf(d);e>-1&&i.splice(e,1)}0===i.length&&a(function(){c(b)})}if(l.indexOf(b)>-1)return c();var h=angular.module(b),i=f(h),j=f(h);return angular.forEach(j,function(a){if(p.push(a),e(a))return d(a);var b=n[a];return b?u(function(){},function(){},function(){w(a,function(a){d(a)})}):(g.warn("module ["+a+"] not loaded and not configured"),d(a)),null}),0===j.length&&d(),null}var x=s.defer(),y="module: "+j.id;if(n[j.id]=j,!j){var z="Module not configured";throw g.error(z),z}if(t.scriptCache.get(y)){g.debug("AppPackage "+j.id+" already loaded."),q=j,x.resolve(j.id);var A=j.resources.links.map(function(a){return i(j.id,a)});m(A,function(a){g.debug("Loaded "+a)})}else u(function(a){g.debug("Loaded "+a)},function(a){g.debug("Loaded "+a)},function(){p.push(j.id),w(j.id,function(){angular.module(j.id).factory("appPackageService",k(j,a,c)),h(g,d,o,angular.copy(p)),t.scriptCache.put(y,j),a(function(){x.resolve(j.id),r.loadComplete=!0})})});return x.promise}function x(){return u.mergeSection("ep.embedded.apps",m),m.path||(m.path="apps"),m.rootRoute||(m.rootRoute="app"),m}return m=x(),{settings:m,load:w,modules:n,getAppPath:i,getAppRoute:j,state:r}}]}]),angular.module("ep.embedded.apps").service("epEmbeddedAppsService",["$rootScope","$http","$q","$log","$location","$window","epUtilsService","epEmbeddedAppsProvider","epEmbeddedAppsConstants","epEmbeddedAppsShellService","epEmbeddedAppsCacheService",function(a,b,c,d,e,f,g,h,i,j,k){function l(a){var b=c.defer();return g.wait(function(){return C.loading!==!0},30,250,function(){m(a).then(function(a){b.resolve(a)})}),b.promise}function m(a){var b=c.defer();return D=[],E=0,C.loadComplete?(a===!0&&v(),b.resolve(!0)):q(b),b.promise}function n(){var a={Success:!0,apps:h.settings.applications},b=c.defer();return b.resolve(a),b.promise}function o(){var a=h.settings.provider;if(a&&"sysconfig"!==a){var b=g.getService(a);return b?b.getApps():[]}return n()}function p(a){var b=c.defer(),e=null;return g.hasProperty(a,"resources.scripts.startup")&&(e=h.getAppPath(a.id,a.resources.scripts.startup)),e&&a.resources.scripts.startup?g.loadScript(e,k.scriptCache).then(function(){try{var c=angular.injector([a.id+"-startup","ng","ngRoute"]),e=c.get("appStartupService");e&&(a.state.startupService=e)}catch(f){d.warn("startup service [appStartupService] was not executed for embedded application: "+a.id)}b.resolve(!0)},function(){d.warn("startup service [appStartupService] was not loaded for embedded application: "+a.id),b.resolve(!1)}):b.resolve(!0),b.promise}function q(a){C.loading=!0;var c=g.getService("epEmbeddedAppsService");o("config").then(function(e){try{e&&e.Success?(D=e.apps,E=0,D.forEach(function(e){var i=h.getAppPath(e,"AppPackage.json");b.get(i).then(function(b){var e=b.data;d.debug("Parsing AppPackage.config file: "+i),e.state={},B[e.id]=e,d.debug("AppPackage name: "+e.name);var h=e.tileSize?e.tileSize.split("x"):["2","1"];if(h&&2===h.length){var j=["","one","two","three","four","five","six","seven","eight","nine","ten"];try{e.tileSize={width:parseInt(h[0]),height:parseInt(h[1])},e.tileClass=(j[e.tileSize.width]||"two")+"-wide "+(j[e.tileSize.height]||"one")+"-tall"}catch(k){d.warn("Invalid value in tileSize property: "+e.tileSize)}}e.epEmbeddedAppsService=c,e.menu&&e.menu.disabled===!0||(e.state.menu={caption:"root",menuitems:[{caption:e.name,description:e.description||e.name,id:"pkg_"+e.id,_id:"pkg_"+e.id,version:e.version||"",action:function(){if(e.launchInTab){var a="./Index.html#"+t(e.id,e.startViewId,"");f.open(a)}else u(e.id)}}]}),p(e).then(function(){e.views=g.mapArray(e.views,"id"),e.initialized=!1,r(a)})},function(b){r(a),d.error("Failed retrieving AppPackage.config file: "+i),d.error(b)})}),C.loadComplete=!D.length):d.warn("Unable to load app package definition files.")}catch(i){C.loading=!1,d.error(i),a.reject(i)}})}function r(b){++E===D.length&&(a.$emit(i.CONFIG_LOADED_EVENT,{configs:B,goToView:u}),C.loading=!1,C.loadComplete=!0,b.resolve(!0))}function s(){return h.getAppPath(arguments)}function t(){return h.getAppRoute(arguments)}function u(a,b){var c=B[a];c&&e.url(t(c.id,b||c.startViewId))}function v(){j.setupShellConfigs(B)}function w(a,b){a.id&&(a._id=b+a.id),angular.forEach(a,function(a){a.id&&(a._id=b+a.id)}),a.menuitems&&w(a.menuitems,b)}function x(a,b,c,d,e){a.state.menu=b,b&&(w(a.state.menu,"pkg_"+a.id+"_"),c.push(a.state.menu)),e.menuToComplete--,e.menuToComplete<1&&d.resolve(c)}function y(){var a=[],b=[],e=c.defer();if(!C.loadComplete)return g.wait(function(){return C.loadComplete},30,250,function(){y().then(function(a){e.resolve(a)})}),e.promise;if(angular.forEach(B,function(c){c.menu&&c.menu.disabled===!0||(c.state.startupService&&c.state.startupService.getMenu?b.push(c):c.state.menu&&a.push(c.state.menu))}),b&&b.length){var f={menuToComplete:b.length};angular.forEach(b,function(b){var c=b.state.startupService.getMenu(b);c&&(c.then?c.then(function(c){x(b,c,a,e,f),d.debug("Retrieved menu from app package: "+b.id);var g=c&&c.Menu&&c.Menu.menuitems?c.Menu.menuitems.length:0;d.debug("Found "+g+" root menu items")}):x(b,c,a,e,f))})}else e.resolve(a);return e.promise}function z(){var a=[];return angular.forEach(B,function(b){b.state.menu&&a.push(b.state.menu)}),a}function A(a,b){var c=[];if(a&&a.views){var d=[];angular.forEach(a.views,function(c){if(c.caption||b){var e=b?c.caption||c.name||c.id:c.caption;d.push({id:"pkg_"+a.id+"_"+c.id,_id:"pkg_"+a.id+"_"+c.id,caption:e,description:c.description,icon:c.icon||"fa fa-list-alt",color:c.tileColor,action:function(){u(a.id,c.id)}})}});var e={};d.length?e={caption:"root",id:"root",menuitems:[{caption:a.name,id:"pkg_"+a.id,menuitems:d}]}:a.menu&&a.menu.disabled===!0||(e=a.state.menu),c={Menu:e}}return c}var B={},C={appId:"",viewId:"",loaded:!1},D=[],E=0;return{initialize:l,state:C,loadConfigurations:m,configs:B,getAppPath:s,getAppRoute:t,setupShellOnStartup:v,currentAppsMenu:z,retrieveAppsMenu:y,buildAppViewsMenu:A,goToView:u}}]),angular.module("ep.templates").run(["$templateCache",function(a){"use strict";a.put("src/components/ep.embedded.apps/embedded-apps.html",'<div id=appHost><div id=splash ng-if=appConfig.splash ng-show=showSplash ep-animation options=appConfig.splash.transition><div id=splashContainer ng-include="getEmbeddedAppPath(appConfig.id, appConfig.splash.templateUrl)"></div></div><div id=appContent ng-show=showApp ep-animation options=currentView.transition><ep-embedded-apps-loader config=appConfig on-complete=onLoaderComplete()></ep-embedded-apps-loader></div></div>')}]);