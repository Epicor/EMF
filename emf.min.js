"use strict";angular.module("ep.login",["ep.token","ep.templates"]),angular.module("ep.templates",[]),angular.module("ep.token",[]),angular.module("ep.login").controller("epLoginCtrl",["$scope","$stateParams","$state","tokenFactory",function(a,b,c,d){a.cancelPath=b.cancelPath||"home",a.user=d.getToken(),a.status="",a.$watch(function(a){return a.hasToken=d.hasToken(),d.hasToken()}),a.login=function(){return a.hasError=!1,a.status="",a.user&&a.user.hasOwnProperty("username")&&a.user.hasOwnProperty("password")&&a.user.username&&a.user.password?void d.login(a.user).success(function(){a.hasToken=!0,c.go("home")}).error(function(b,c,d,e){var f=void 0!==e&&null!==e?e.url:"";a.status="Login Failure at: "+f,a.hasError=!0}):(a.hasError=!0,void(a.status="Please fill required fields."))},a.logout=function(){d.logout(),a.user={},a.hasToken=!1}}]),angular.module("ep.login").directive("epLogin",function(){return{restrict:"E",controller:"epLoginCtrl",templateUrl:"src/components/ep.login/login.html"}}),angular.module("ep.token").provider("tokenConfig",function(){var a,b={restUri:"https://localhost/ICE3/TokenResource.svc/",tokenId:"epicor.token.auth"};this.$get=function(){var c=$.ajax({type:"GET",url:"sysconfig.json",cache:!1,async:!1,contentType:"application/json"});if(a=c.status,200===c.status){var d=angular.fromJson(c.responseText);d.hasOwnProperty("ep_token_config")&&angular.extend(b,d.ep_token_config)}return b}}),angular.module("ep.token").factory("tokenFactory",["$cookieStore","$http","tokenConfig",function(a,b,c){function d(b){return h(b).success(function(d){i(d),a.put(c.tokenId,b)}).error(function(){})}function e(){a.remove(c.tokenId)}function f(){return a.get(c.tokenId)}function g(){var a=f();return void 0!==a&&!angular.equals({},a)}function h(a){return b.defaults.headers.post=a,b.post(c.restUri,{})}function i(b){b&&b.hasOwnProperty("bearer")&&a.put(c.tokenId,b)}return{login:d,logout:e,getToken:f,hasToken:g}}]),angular.module("ep.templates").run(["$templateCache",function(a){a.put("src/components/ep.login/login.html",'<div class=thumbnail><div class=caption><h3 ng-hide=hasToken><span class="icon icon-enter"></span> Login</h3><h3 ng-show=hasToken><span class="icon icon-exit"></span> Logout</h3><hr></div><form role=form><div class=form-group><label for=user-name class="col-sm-2 control-label">User:</label><div><input class=form-control id=user-name value={{::user.username}} ng-model=user.username placeholder=username required></div></div><div class=form-group><label for=user-password class="col-sm-2 control-label">Password:</label><div><input type=password class=form-control id=user-password value={{::user.password}} ng-model=user.password placeholder=password required></div></div></form><hr><p></p><div class="alert alert-danger" id=validationSummary role=alert ng-show=hasError>{{status}}</div><div><a class="btn btn-default" ui-sref={{::cancelPath}}>Cancel</a> <button type=button class="btn btn-primary" ng-hide=hasToken ng-click=login()>Login</button> <button type=button class="btn btn-primary" ng-show=hasToken ng-click=logout()>Logout</button></div></div>')}]);